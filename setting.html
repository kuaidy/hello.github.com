<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="keywords" content="优秀网站，有趣网站，创意网站，网址导航，上网主页，网站分享">
    <meta name="description" content="优秀网站，在线音乐，免费视频，设计，游戏，学习，阅读，资源搜索，导航">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <base target="_blank">
	<title>寻-找一些有趣的东西</title>
	<link rel="stylesheet" href="css/style.css">
	<script src="js/jquery.min.js"></script>
	<script>
		var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "https://hm.baidu.com/hm.js?03f8ad279ffe2551a5248a523213cac4";
		  var s = document.getElementsByTagName("script")[0]; 
		  s.parentNode.insertBefore(hm, s);
		})();
	</script>
	<meta name="baidu_union_verify" content="eca8b06640ca20341ee578ec86d7e7f3">
	<meta name="baidu-site-verification" content="wx66rdv1hJ" />
</head>
<body>
	<div class="main">
	<div id="header" class="outbox"><!--header-->
        <div class="navinner">
            <span id="span2"><a href="http://www.rdonly.com/">寻</a></span>
            <span id="span3">
                <ul id="nav">
                    <!-- <li><i>new</i><a href="./tooldown.html">软件下载</a></li> -->
                    <!-- <li><a target="_blank" href="https://shimo.im/docs/tAx0zmGUMLwPTdsq/ 「留言&闲聊」">留言</a></li> -->
                    <li id="moreinfo">
                        <a href="./moresites.html" title="更多站点">更多</a>
                        <!-- <ul id="moreinfo_tags">
                            <li class="moreinfo_tag"><a href="http://blog.rdonly.com/">博客</a></li>
                        </ul> -->
                    </li>
                    <li><a href="./update.html">关于</a></li>
                    <li><a href="./update.html">···</a></li>
                </ul>
            </span>
        </div>
    </div>

	<div class="Setting">
		<div class="setname">
			<ul class="ulsettypes">
                <li class="lisettype">
					<label>阅读（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="read">
				</li>
                <li class="lisettype">
					<label>社区（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="community">
				</li>
				<li class="lisettype">
					<label>听歌（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="music">
				</li>
                <li class="lisettype">
					<label>文艺（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="musicarticle">
				</li>
                <li class="lisettype">
					<label>视频（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="video">
				</li>
                <li class="lisettype">
					<label>直播（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="show">
				</li>
				<li class="lisettype">
					<label>字幕（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="caption">
				</li>
                <li class="lisettype">
					<label>资源（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="resource">
				</li>
                <li class="lisettype">
					<label>动漫（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="carton">
				</li>
                <li class="lisettype">
					<label>游戏（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="game">
				</li>
                <li class="lisettype">
					<label>设计（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="design">
				</li>
                <li class="lisettype">
					<label>图标（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="icon">
				</li>
                <li class="lisettype">
					<label>PPT（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="ppt">
				</li>
                <li class="lisettype">
					<label>博客（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="blog">
				</li>
                <li class="lisettype">
					<label>工具（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="tool">
				</li>
                <li class="lisettype">
					<label>在线文档（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="doconline">
				</li>
                <li class="lisettype">
					<label>站长工具（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="webmaster">
				</li>
                <li class="lisettype">
					<label>学习（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="study">
				</li>
                <li class="lisettype">
					<label>问答（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="question">
				</li>
                <li class="lisettype">
					<label>网络安全（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="network">
				</li>
                <li class="lisettype">
					<label>应用（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="app">
				</li>
                <li class="lisettype">
					<label>自媒体（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="write">
				</li>
                <li class="lisettype">
					<label>工作（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="work">
				</li>
                <li class="lisettype">
					<label>导航（默认）</label>
					<input type="checkbox" class="switch" checked="checked" value="lead">
				</li>
				<li class="lisettype">
					<label>自定义网址</label>
					<input type="checkbox" class="switch" value="custom">
				</li>
			</ul>
		</div>
		<div class="setoption">
			<!-- <input type="button" value="添加分类" class="optionbutton"> -->
			<input type="button" value="添加网址" class="optionbutton" onclick="AddSite();">
			<!-- <input type="button" value="保存" class="optionbutton"> -->
			<!-- <input type="button" value="导出" class="optionbutton"> -->
			<!-- <input type="button" value="导入" class="optionbutton"> -->
		</div>

		<div id="content" class="inner"><!--content-->
			<!-- <div class="tags"> 
				<span class="titlesign"></span>		
				<h3>常用网站</h3>
			</div>
			<div class="sitediv" id="">
				
			</div> -->
		</div> 
	</div>

	<div class="AddSites">
	</div>
	
	<div class="AddForm">
		<div class="sitetitle">
			<span>网站名称</span>
			<input type="text" id="sitename" class="siteinput">
		</div>

		<div class="siteurl">
			<span>网站地址</span>
			<input type="text" id="siteurl" class="siteinput">
		</div>

		<div class="sitetype">
			<span>网站分类</span>
			<input type="text" list="typelist" placeholder="请选择" class="siteinput" id="sitetype">
                <datalist id="typelist">
                　　<option value="常用"></option>
                </datalist>
		</div>
		<div class="siteoption">
			<input type="button" class="optionbutton" value="确定" onclick="Confirm();">
			<input type="button" class="optionbutton" value="取消" onclick="Cancel();">
		</div>
	</div>	
	</div>
    
</body>

<script>
	$(".switch").click(function(e){
		console.log(this);
		var data={"defaulttype":this.value,"canuse":this.checked};
		var flag=IsSupportIndexeddb();
		if(flag){
			AddData(TBTYPE,data,IndexDefaultType,this.value);
		}
	});

	//显示添加界面
	function AddSite(){
		$(".AddSites").css("display","flex");
		$(".AddForm").css("display","flex");
	}

	//关闭添加界面
	function Cancel(){
		$(".AddSites").css("display","none");
		$(".AddForm").css("display","none");
	}

	//向indexdb添加数据
	function Confirm(){
		var flag=IsSupportIndexeddb();
		var sitename=$("#sitename").val();
		var siteurl=$("#siteurl").val();
		var sitetype=$("#sitetype").val();
		var data={"type":sitetype,"name":sitename,"url":siteurl};
		if(flag){
			Add(TBSITES,DBNAME,VERSION,data);
		}
	}

	//判断浏览器是否可用indexeddb数据库
	function IsSupportIndexeddb(){
		window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
		
		window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction;
		window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange
		
		if (!window.indexedDB) {
			window.alert("您的浏览器不支持indexeddb数据库，无法使用此功能，请使用最新版谷歌，edge，火狐浏览器！")
			return false;
		}else{
			return true;
		}
	}

	var DBNAME="NAVDATABASE";
	var VERSION=1;
	var TBTYPE="SITESTYPESDEFAULT";
	var TBSITES="SITES"
	var db;
	var IndexDefaultType="defaulttype";
	var IndexType="type";

	//创建一个数据库，版本号为1，表
	function CreateDatabase(){
		var request = indexedDB.open(DBNAME,VERSION);
		
		request.onerror = function(event) {
			console.log("打开失败");
		};
         
		request.onupgradeneeded = function(event) {
			db = event.target.result;
			if (!db.objectStoreNames.contains(TBSITES)){
				var objstore=db.createObjectStore(TBSITES, { keyPath:'id',autoIncrement:true });
				objstore.createIndex('type', 'type', { unique: false });
			}
			if (!db.objectStoreNames.contains(TBTYPE)){
				var objstore=db.createObjectStore(TBTYPE, {keyPath:'id',autoIncrement:true });
				objstore.createIndex('defaulttype', 'defaulttype', { unique: false });
			}
		}

		request.onsuccess = function(event) {
			db = event.target.result;
            console.log("打开成功");
         };
	}

	//添加内容
	function AddData(obj,data,index,indexvalue){
		if(db){
			var transaction = db.transaction([obj], 'readonly');
			var store = transaction.objectStore(obj);
			var index = store.index(index);
			var request = index.get(indexvalue);

			request.onsuccess = function (e) {
				var result = e.target.result;
				if (result) {
					switch(obj){
						case TBTYPE:
							result.canuse=data.canuse;
							break;
					}
					Update(obj,result);
				} else {
					Add(obj,data);
				}
			}
		}
	};

	//添加数据
	function Add(obj,data){
		if(db){
			var res = db.transaction([obj],'readwrite').objectStore(obj).add(data);
			res.onsuccess = function (event) {
				console.log('数据写入成功');
			};
			res.onerror = function (event) {
				console.log('数据写入失败');
			}
		}
	}

	//更新数据
	function Update(obj,data){
		if(db){
			var res = db.transaction([obj], 'readwrite').objectStore(obj).put(data);
			res.onsuccess = function (e) {
				console.log('数据更新成功');
			}

			res.onerror = function (event) {
				console.log('数据更新失败');
			}
		}
	}


	//读取数据
	function Read(obj,index,indexvalue){
		CreateDatabase();
		if(db){
			var transaction = db.transaction([obj], 'readonly');
			var store = transaction.objectStore(obj);
			var index = store.index(index);
			var request = index.get(indexvalue);

			request.onsuccess = function (e) {
				var result = e.target.result;
				if (result) {
					console.log(result);
				} else {
					// ...
				}
			}
		}
	};

	function readAll() {
		CreateDatabase();
		if(db){
			var arr=new Array();
			var request = indexedDB.open(DBNAME,VERSION);
			request.onsuccess = function(event) {
				db = event.target.result;
				var tran=db.transaction(TBSITES);
				var objectStore =tran.objectStore(TBSITES);
				objectStore.openCursor().onsuccess = function (event) {
					var cursor = event.target.result;
					if (cursor) {
						arr.push(cursor.value);
						cursor.continue();
					} else {
						console.log('没有更多数据了！');
					}
				};
				tran.oncomplete=function(event){
					var data=HandleData(arr);
					ShowData(data);
				}
			}
		}
	};

	function LoadData(){
		readAll();
	};
	LoadData();

	//数据按照type分类
	function HandleData(arr){
		var nlist = [];
		for (var i = 0; i < arr.length; i++) {
			console.log(arr[i].str);
			if (nlist.length == 0) {
				nlist.push({
					type: arr[i].type,
					data: [arr[i]]
				})
			} else {
				var index = nlist.findIndex(item => item.type == arr[i].type);
				if (index >= 0) {
					nlist[index].data.push(arr[i])
				} else {
					nlist.push({
						type: arr[i].type,
						data: [arr[i]]
					})
				}
			}
		}
		return nlist;
	}

	function ShowData(data){
		for(var i=0;i<data.length;i++){
			console.log(data);
			var innercontent='<div class="tags" onclick="ChangeStatus"><span class="titlesign"></span><h3>'+data[i].type+'</h3></div><div class="sitediv"><ul id="'+i+'" class="sitesul"></ul></div>';
			$("#content").append(innercontent);
			
			var resourcename='#'+i;
			var fatherdom=$(resourcename);
			for(var j=0;j<data[i].data.length;j++){
				var x=Math.floor(Math.random()*100+1);
				var y=Math.floor(Math.random()*100+1);
				var z=Math.floor(Math.random()*100+1);

				var firstname=data[i].data[j].name.substring(0,1);
				var childdom='<li class="sitesli"><i class="siteicon" style="background-color:#'+x+y+z+'">'+firstname+'</i><a class="sitetext" href="'+data[i].data[j].url+'">'+data[i].data[j].name+'</a></li>';
				fatherdom.append(childdom);
			}
			
			fatherdom.append("<li style='clear:both;'></li>");
			
		}
	}

</script>
</html>